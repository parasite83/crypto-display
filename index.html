<!doctype html>
<html>
  <head>
    <title>Crypto price display</title>
    <style>
      body {
        background-color: #000;
        overflow: hidden;
      }

      .price {
        display: flex;
        width: 100vw;
        height: 100vh;
        align-items: center;
        justify-content: center;
        font: 16vw Arial, sans-serif;
        margin: auto;
      }

      [status="normal"] {
        color: grey;
      }

      [status="inc"] {
        color: #2f2;
      }

      [status="desc"] {
        color: #f22;
      }
    </style>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"></script>
    <script>
      (function($) {
        var placeholder = $('.price');
        var webSocket;
        var refreshInterval;
        var price;
        var priceOld = 0;
        var diff = 0;
        var status = 'normal';

        var subscribeMsg = {
          "event": "bts:subscribe",
          "data": {
            "channel": "order_book_ethusd"
          }
        };

        var formatter = new Intl.NumberFormat('en-IN', {
          maximumFractionDigits: 1
        });

        var updatePrice = function(data) {
          price = data.asks[0][0];

          if (price !== priceOld) {
            diff = price - priceOld;

            if (diff == 0) {
              status = 'normal';
            }
            if (diff > 0) {
              status = 'inc';
            }
            if (diff < 0) {
              status = 'desc';
            }

            priceOld = price;
          }
        };

        var refresh = function() {
          placeholder.html(formatter.format(price));
          placeholder.attr('status', status);
        }

        var initWebsocket = function() {
          ws = new WebSocket("wss://ws.bitstamp.net");

          ws.onopen = function () {
            ws.send(JSON.stringify(subscribeMsg));
          };

          ws.onmessage = function (evt) {
            response = JSON.parse(evt.data);

            switch (response.event) {
              case 'data': {
                updatePrice(response.data);
                break;
              }
              case 'bts:request_reconnect': {
                initWebsocket();
                break;
              }
            }

          };

          ws.onclose = function () {
            initWebsocket();
          };
        };

        initWebsocket();

        refreshInterval = setInterval(function() {
          refresh();
        }, 1000);

      })(jQuery);
    </script>
  </head>
  <body>
    <div class="price" status="normal">
      Loading...
    </div>
  </body>
</html>
